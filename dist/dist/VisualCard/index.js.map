{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js","src://tavern_helper_template/webpack/bootstrap","src://tavern_helper_template/external var \"Vue\"","webpack://tavern_helper_template/./src/VisualCard/Card.vue?0240","webpack://tavern_helper_template/src/VisualCard/Card.vue?2a0f","webpack://tavern_helper_template/./src/VisualCard/App.vue?693e","webpack://tavern_helper_template/src/VisualCard/App.vue?5df2","src://tavern_helper_template/src/VisualCard/index.ts","src://tavern_helper_template/src/util/script.ts"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n// runtime helper for setting properties on components\n// in a tree-shakable way\nexports.default = (sfc, props) => {\n    const target = sfc.__vccOpts || sfc;\n    for (const [key, val] of props) {\n        target[key] = val;\n    }\n    return target;\n};\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","const __WEBPACK_NAMESPACE_OBJECT__ = Vue;","import { defineComponent as _defineComponent } from 'vue';\nimport { createElementVNode as _createElementVNode, toDisplayString as _toDisplayString, normalizeClass as _normalizeClass, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = { class: \"card-inner\" };\nconst _hoisted_2 = { class: \"card-front\" };\nconst _hoisted_3 = [\"src\", \"alt\"];\nconst _hoisted_4 = { class: \"card-name\" };\nconst _hoisted_5 = { class: \"card-back\" };\nconst _hoisted_6 = { class: \"back-content\" };\nconst _hoisted_7 = { class: \"back-text\" };\nimport { ref } from 'vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'Card',\n    props: {\n        data: {}\n    },\n    setup(__props) {\n        const props = __props;\n        const isFlipped = ref(false);\n        const toggleFlip = () => {\n            isFlipped.value = !isFlipped.value;\n        };\n        // 这里需要一个映射表或者根据 img_code 生成路径的逻辑\n        // 假设图片放在 public/visual_cards/ 或者某个特定的 URL 下\n        // 根据用户需求，这里应该有一个预设列表，但目前先用占位符或者简单的路径映射\n        const getImageSrc = (code) => {\n            // 实际项目中可能需要根据 code 映射到具体的图片 URL\n            // 这里暂时假设图片名为 code.png，放在 assets 目录下（需要 webpack 处理）\n            // 或者直接返回一个占位图 URL\n            // 由于我们不知道用户的具体图片资源，这里先返回一个基于 name 和 code 的占位图服务，或者留空待填\n            return `https://placehold.co/200x300?text=${encodeURIComponent(props.data.name + '\\n' + code)}`;\n        };\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", {\n                class: _normalizeClass([\"visual-card\", { flipped: isFlipped.value }]),\n                onClick: toggleFlip\n            }, [\n                _createElementVNode(\"div\", _hoisted_1, [\n                    _createElementVNode(\"div\", _hoisted_2, [\n                        _createElementVNode(\"img\", {\n                            src: getImageSrc(__props.data.img_code),\n                            alt: __props.data.name,\n                            class: \"card-image\"\n                        }, null, 8 /* PROPS */, _hoisted_3),\n                        _createElementVNode(\"div\", _hoisted_4, _toDisplayString(__props.data.name), 1 /* TEXT */)\n                    ]),\n                    _createElementVNode(\"div\", _hoisted_5, [\n                        _createElementVNode(\"div\", _hoisted_6, [\n                            _createElementVNode(\"p\", _hoisted_7, _toDisplayString(__props.data.back_text), 1 /* TEXT */)\n                        ])\n                    ])\n                ])\n            ], 2 /* CLASS */));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./Card.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./Card.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./Card.vue?vue&type=style&index=0&id=87d1e5f6&scoped=true&lang=scss\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-87d1e5f6\"]])\n\nexport default __exports__","import { defineComponent as _defineComponent } from 'vue';\nimport { renderList as _renderList, Fragment as _Fragment, openBlock as _openBlock, createElementBlock as _createElementBlock, createBlock as _createBlock } from \"vue\";\nconst _hoisted_1 = { class: \"visual-card-container\" };\nimport { onMounted, ref } from 'vue';\nimport Card from './Card.vue';\nexport default /*@__PURE__*/ _defineComponent({\n    __name: 'App',\n    setup(__props) {\n        const cards = ref([]);\n        onMounted(async () => {\n            // 获取当前消息 ID\n            const messageId = getCurrentMessageId();\n            if (messageId === undefined)\n                return;\n            // 获取消息内容\n            // getChatMessages 返回的是数组，如果 messageId 是索引，需要确认 getChatMessages(messageId) 的行为\n            // 根据定义：getChatMessages(range) 返回 ChatMessage[]\n            // 如果 range 是数字，返回该楼层的消息数组（可能包含 swipes）\n            const messages = getChatMessages(messageId);\n            if (!messages || messages.length === 0)\n                return;\n            // 取第一条（当前显示的消息）\n            const message = messages[0];\n            const content = message.message; // ChatMessage 使用 message 字段，而不是 mes\n            // 解析 content 中的 <visual_cards> 标签\n            const regex = /<visual_cards>([\\s\\S]*?)<\\/visual_cards>/;\n            const match = content.match(regex);\n            if (match && match[1]) {\n                try {\n                    const jsonStr = match[1].trim();\n                    const parsedData = JSON.parse(jsonStr);\n                    if (Array.isArray(parsedData)) {\n                        cards.value = parsedData;\n                    }\n                }\n                catch (e) {\n                    console.error('Failed to parse visual cards JSON:', e);\n                }\n            }\n        });\n        return (_ctx, _cache) => {\n            return (_openBlock(), _createElementBlock(\"div\", _hoisted_1, [\n                (_openBlock(true), _createElementBlock(_Fragment, null, _renderList(cards.value, (card, index) => {\n                    return (_openBlock(), _createBlock(Card, {\n                        key: index,\n                        data: card\n                    }, null, 8 /* PROPS */, [\"data\"]));\n                }), 128 /* KEYED_FRAGMENT */))\n            ]));\n        };\n    }\n});\n","/* unplugin-vue-components disabled */import script from \"./App.vue?vue&type=script&setup=true&lang=ts\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=ts\"\n\nimport \"./App.vue?vue&type=style&index=0&id=42da87ae&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/.pnpm/vue-loader@17.4.2_vue@3.5.2_fcc8164c33ab268660e3819796c9f485/node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-42da87ae\"]])\n\nexport default __exports__","import { createApp } from 'vue';\r\nimport { teleportStyle } from '../util/script';\r\nimport App from './App.vue';\r\nimport './index.html'; // 引入 html 以便被打包\r\n\r\n$(() => {\r\n    // 注入样式到主页面\r\n    teleportStyle();\r\n\r\n    // 挂载 Vue 应用\r\n    const app = createApp(App);\r\n    app.mount('#app');\r\n});","export async function loadReadme(url: string): Promise<boolean> {\n  const readme = await fetch(url);\n  if (!readme.ok) {\n    return false;\n  }\n  const readme_text = await readme.text();\n  replaceScriptInfo(readme_text);\n  return true;\n}\n\nexport function teleportStyle() {\n  if ($(`head > div[script_id=\"${getScriptId()}\"]`).length > 0) {\n    return;\n  }\n  const $div = $(`<div>`).attr('script_id', getScriptId()).append($(`head > style`, document).clone());\n  $('head').append($div);\n}\n\nexport function deteleportStyle() {\n  $(`head > div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function createScriptIdDiv(): JQuery<HTMLDivElement> {\n  return $('<div>').attr('script_id', getScriptId()) as JQuery<HTMLDivElement>;\n}\n\nexport function destroyScriptIdDiv(): void {\n  $(`div[script_id=\"${getScriptId()}\"]`).remove();\n}\n\nexport function reloadOnChatChange(): EventOnReturn {\n  let chat_id = SillyTavern.getCurrentChatId();\n  return eventOn(tavern_events.CHAT_CHANGED, new_chat_id => {\n    if (chat_id !== new_chat_id) {\n      chat_id = new_chat_id;\n      window.location.reload();\n    }\n  });\n}\n"],"names":["exports","sfc","props","target","__vccOpts","key","val","__webpack_module_cache__","Vue","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","__name","data","setup","__props","isFlipped","ref","toggleFlip","value","_ctx","_cache","flipped","onClick","src","code","img_code","encodeURIComponent","name","alt","back_text","__webpack_require__","moduleId","cachedModule","undefined","module","__webpack_modules__","cards","onMounted","async","messageId","getCurrentMessageId","messages","getChatMessages","length","match","message","jsonStr","trim","parsedData","JSON","parse","Array","isArray","e","console","error","card","index","Card","$","getScriptId","$div","attr","append","document","clone","teleportStyle","createApp","App","mount"],"ignoreList":[],"sourceRoot":""}